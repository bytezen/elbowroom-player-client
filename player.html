<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script type="text/javascript" src="js/lodash.min.js"></script>
<script src="js/p5.min.js"></script>
<script src="js/p5.dom.min.js"></script>
<script src="js/p5.spacebrew.js"></script>  
<link rel="stylesheet" type="text/css" href="css/w3.css">
<style type="text/css">
    .dirbutton {
    width: 100px;
    height: 100px;
  }

  .btnContainer {
    min-height: 122px;
  }

  .btnContainer p {margin: 0px; }
  #ui {
    width: 400px;
    height: 400px;
    max-width: 400px;
    max-height: 400px;
  }    

</style>
</head>
<body class="w3-padding-24">
  <h1 class="w3-center w3-text-gray"> Elbow Room </h1>  
  <div id="content" class="w3-content w3-section  w3-padding-16" style="max-width: 600px; ">
<!--   <h1 class="w3-center w3-text-green"> Elbow Room </h1> -->
  <h2 id="playerId" class="w3-center w3-text-green w3-margin-bottom"> Player 010 </h2>
<!--   <div class="w3-content w3-container _w3-cell w3-border" id="sketch" style="max-width: 800px;"> -->
    <div id="ui" class="w3-content  w3-display-container w3-padding-16">
      
      <!--           -->
      <!-- up button -->      
      <!--           -->

      <div id="btnUp" class="btnContainer w3-third w3-green w3-cell w3-display-topmiddle w3-cell-middle _w3-border w3-button">
        <p class="w3-display-middle w3-xxlarge">up</p>
      </div>
      
      <div id="btnDown" class="btnContainer w3-third w3-green ue w3-cell w3-display-bottommiddle w3-cell-middle _w3-border w3-button">
        <p class="w3-display-middle w3-xxlarge">down</p>
      </div>

      
      <div id="btnLeft" class="btnContainer w3-third w3-green w3-cell w3-display-left w3-cell-middle _w3-border w3-button">
        <p class="w3-display-middle w3-xxlarge">left</p>
      </div>
      
      
      <div id="btnRight" class="btnContainer w3-third w3-green w3-cell w3-display-right w3-cell-middle _w3-border w3-button">
        <p class="w3-display-middle w3-xxlarge">right</p>
      </div>
            
      
    </div>
  </div>
<!--   </div> -->

<script type="text/javascript">
  let SB_SERVER = "127.0.0.1" //TODO: pass via queryParam
      ,SB_PORT = 9000
      ,SB_NAME = "Player 0"   //TODO: pass via queryParam
      ,SB_ID = "player0"      //TODO: pass via queryParam
      ,SB_CHANNEL_TYPE = "string"
      ,SB_DESCR = SB_NAME + " player client"

  let spacebrew = new Spacebrew()
  
  spacebrew.addPublish(SB_ID,SB_CHANNEL_TYPE,"")
  //spacebrew.addSubscribe("player0_moves","string","")
  //spacebrew.onStringMessage( onStringMessage )
  spacebrew.connect(SB_SERVER, SB_PORT, SB_NAME, SB_DESCR);
</script>

<script type="text/javascript">
    const LEFT   = 'left'
         ,RIGHT  = 'right'
         ,UP     = 'up'
         ,DOWN   = 'down'

    function setup() {
      noCanvas();
      noLoop();

      initButtonHandlers();

    }

    let initButtonHandlers = () => {
      btns = selectAll(".btnContainer")
      _.each(btns, 
             b => {
              let id = b.id();
              if( id == 'btnUp') { 
                b.mousePressed(onDirectionButtonClick.bind(null,'up'));
              }
              if( id == 'btnDown') { 
                b.mousePressed(onDirectionButtonClick.bind(null,'down'))
              }
              if( id == 'btnLeft') { 
                b.mousePressed(onDirectionButtonClick.bind(null,'left'))
              }
              if( id == 'btnRight') { 
                b.mousePressed(onDirectionButtonClick.bind(null,'right'))
              }
            });
    }

    let sendToServer = (channel,type,value) =>
      {
        console.log('[sendToServer]',channel,type,value);
        spacebrew.send(channel,type,value);
      }

    let move = sendToServer.bind(null,SB_ID,SB_CHANNEL_TYPE);

    let onDirectionButtonClick = 
          (direction) => {
            console.log('[onDirectionButtonClick]',direction)
          if( direction === LEFT  || 
              direction === UP    ||   
              direction === RIGHT || 
              direction === DOWN ) {
            move(direction);
          }                                  
        }

    function keyPressed(value) {
      // console.log(keyCode);

      if(keyCode === 37) { move(LEFT) }
      if(keyCode === 38) { move(UP) }
      if(keyCode === 39) { move(RIGHT) }
      if(keyCode === 40) { move(DOWN) }
    }

    function keyTyped() {
      if(key === 'w' || key === 'W') { move(UP) }
      if(key === 'a' || key === 'A') { move(LEFT) }
      if(key === 's' || key === 'S') { move(DOWN) }        
      if(key === 'd' || key === 'D') { move(RIGHT) }
    }


</script>
</body>
</html>


